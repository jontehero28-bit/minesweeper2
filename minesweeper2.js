var board = [];
var rows = 8;
var columns = 8;

var minesCount = 10;
var minesLocation = [];          //id eller class f칬r varje ruta ex. "1-2, 3-4 osv."

var tilesClicked = 0;          //n칛r man trycker p친 en ruta v칛rden g친r upp med 1
var flagEnabled = false;       //n칛r man trycker p친 flaggan den byter v칛rde till true

var gameOver = false;          //ifall gameOver = true spelet slutas och man kan inte trycka n친got mer. (kanske g칬r en restart button senare)

window.onload = function()    //ska genomf칬ra det direkt efter sidan laddas klart
{
    startGame();
}

function setMines()          //st칛ller ut miner och jag skriver id d칛r minerna ska vara
{
    minesLocation.push("0-0");
    minesLocation.push("0-1");
    minesLocation.push("3-5");
    minesLocation.push("1-2");
    
}

function startGame() //startar de funktioner n칛r spelet b칬rjas
{ 
    setMines();
    document.getElementById("mine-count").innerText = minesCount; //ta elementen mine-count och byt ut den mot minesCount
    document.getElementById("flag-button").addEventListener("click", setFlag); //startar d
}

for (let r = 0; r < rows; r++) {  //skapar id rows f칬r 8st
    let row = [];
    for (let c = 0; c < columns; c++) {  //skapar id columner f칬r 8st
        
        let tile = document.createElement("div"); //skapar id
        tile.id = r.toString() + "-" + c.toString(); //tile.id kopplar ihop row delen och column delen
        tile.addEventListener("click", clickTile);
        document.getElementById("board").append(tile);
        row.push(tile);
    }
    board.push(row);
    
}
console.log(board); //g칬r s친 att jag kan se det i consolen.


function setFlag() {
    if (flagEnabled)
    {
        flagEnabled = false;
        document.getElementById("flag-button").style.backgroundColor = "lightgray";
    }
    else
    { 
        
    flagEnabled = true;
    document.getElementById("flag-button").style.backgroundColor = "darkgrey";
    
    }
}

function clickTile ()
{
    let tile = this; //referar till rutan som blev tryckt
    if (flagEnabled)
    {
        if (tile.innerText == "") //ifall det finns ingen text p친 rutan s친 kan man placera flagga p친 den
        {
            tile.innerText = "游뛀" //och d친 placeras flaggan
        }
        else if (tile.innerText == "游뛀") //ifall det finns flaga p친 rutan s친 kan man ta bort den
        {
            tile.innerText = ""; //s친 kan man ta bort den
        }
        return;
    }

    if (minesLocation.includes(tile.id))
    {
        //alert("GAME OVER");
        gameOver = true;
        revealMines();
        return;
    }
    /*tex. ifall id 칛r "0-0" d친 kommer den divideras med en streck och sen returnera 
     en array med tv친 siffror ["0", "0"] som 칛r strings*/
    let coords = tile.id.split("-"); 
    let r = parseInt(coords[0]);
    let c = parseInt(coords[1]);
    checkMine(r, c);
}

function revealMines()//g칬r s친 att man ser miner
{
    for (let r = 0; r < rows; r++) //den g친r igenom rutor f칬rst i rows
    {
        for (let c = 0; c < columns; c++) //sen columner
        {
            let tile = board[r][c];              //Array.prototype.includes(tile.id) ifall v칛rden i parentesen st칛mmer d친 "includes" returnerar v칛rde true
            if (minesLocation.includes(tile.id)) //ifall minesLocation includerar tile.id och den 칛r true d친 visar alla andra v칛rde d칛r tile.id 칛r true med bomb
            {
                tile.innerText = "游눢";           
                tile.style.backgroundColor = "red";
            }
        }
    }
        
    
}

function checkMine(r, c)
{
    if(r < 0 || r >= rows || c < 0 || c >= columns)
    {
        return;
    }

    let minesFound = 0; //antal hittade miner     /*jag ska g친 igenom rutorna runt om bomben. Jag chechar rutor runt de*/ 

    //top 3
    minesFound += checkTile(r-1, c-1); //top left 
    minesFound += checkTile(r-1, c); //top
    minesFound += checkTile(r-1, c+1); //top right

    //left and right
    minesFound += checkTile(r, c-1); //left
    minesFound += checkTile(r, c+1); //right

    //bottom
    minesFound += checkTile(r+1, c-1); //bottom left
    minesFound += checkTile(r+1, c); //bottom 
    minesFound += checkTile(r+1, c+1); //bottom right

    if(minesFound > 0)
    {
        board[r][c].innerText = minesFound;
        board[r][c].classList.add("b" + minesFound.toString()); //칛ndrar f칛rg p친 siffran beroende p친 hur m친nga bomber det  칛r. Tar det fr친n style.css dokument
    }
}

function checkTile(r, c)
{
    if(r < 0 || r >= rows || c < 0 || c >= columns)
    {
        return 0;
    }

    if (minesLocation.includes(r.toString() + "-" + c.toString()))
    {
        return 1;
    }
    return 0;
}
